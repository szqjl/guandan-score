# 把数制规则详解

## 一、基本规则

### 1.1 牌级范围
每局牌从2至A，包括：**2、3、4、5、6、7、8、9、10、J、Q、K、A、A¹、A²、A³**

### 1.2 比赛设置
- **最大把数**: 7-15把可选（预设）
- **比赛方式**: 双方按照相同的升级规则进行比赛
- **重要原则**: A不能被越过，必打

### 1.3 游戏阶段
一局分为两个阶段：
- **常规阶段**: 2-A（正常等级升级阶段）
- **A阶段**: 当任何一方到达A时，进入A阶段

## 二、升级规则

### 2.1 基本升级规则
| 操作 | 分数变化 | 说明 |
|------|----------|------|
| 双上 | +3 | 点击双上按钮 |
| T3（1游3游） | +2 | 点击T3按钮 |
| T4（1游末游） | +1 | 点击T4按钮 |

### 2.2 按钮点击规则
- **有成绩才能点击**: 只有获得相应成绩才能点击对应按钮
- **无成绩不点击**: 没有获得成绩就不能点击按钮

## 三、A阶段规则

### 3.1 A阶段三次过A尝试规则
A→A¹→A²→A³（A³是失败显示状态）

### 3.2 A阶段升级条件

#### 3.2.1 显示A¹的条件（满足其中一个即可）
**触发条件**:
1. **自己操作**: 当点了自身的T4（1游末游），且本方处于A阶段（当前本方比分为A）
2. **对方影响**: 被对方点了任何按钮，且本方处于A阶段（当前本方比分为A），且这是本方首次到达A阶段

**提示信息**: "某方第1次过A未成功，加油！"

#### 3.2.2 显示A²的条件（满足其中一个即可）
**触发条件**:
1. **自己操作**: 当点了自身的T4（1游末游），且本方处于A¹阶段（当前本方比分为A¹）
2. **对方影响**: 被对方点了任何按钮，且本方处于A¹阶段（当前本方比分为A¹），且这是本方首次到达A¹阶段

**提示信息**: "某方第2次过A未成功，加油！"

#### 3.2.3 显示A³的条件（满足其中一个即可）
**触发条件**:
1. **自己操作**: 当点了自身的T4（1游末游），且本方处于A²阶段（当前本方比分为A²）
2. **对方影响**: 被对方点了任何按钮，且本方处于A²阶段（当前本方比分为A²），且这是本方首次到达A²阶段

**提示信息**: "某方第3次过A未成功，遗憾惜败。游戏结束。"

### 3.3 重要说明
只有在本方首次到达A/A¹/A²阶段时，对方升级才会触发A阶段推进。如果本方已经在A/A¹/A²阶段，对方再次升级不会触发推进。

## 四、胜负判定规则

### 4.1 等级优先级
**优先级顺序**: **A³ > A² > A¹ > A > K > Q > J > 10 > 9 > 8 > 7 > 6 > 5 > 4 > 3 > 2**

### 4.2 追不上机制
**判定条件**:
1. **领先优势过大**: 如果一方领先优势过大，即使剩余把数全胜也无法追上
2. **A阶段差距**: 一方已经到了A，另外一方没到A，且剩余把数不足以让另一方追到A

**例子**: 东西方A，南北方10，剩余1把。南北方最多能得10+3=13分（K），无法追到A，东西方获胜。

### 4.3 追不上预警机制
**触发条件**: 剩余5把时，系统检测到落后方T3追不上，但双上能追上时。

**预警规则**:
1. **A阶段差距预警**: 一方在A阶段，另一方不在A阶段，且T3追不上但双上能追上
2. **等级差距预警**: 双方等级差距在T3和双上追赶能力之间

**预警逻辑**:
- **T3最大得分**: 剩余把数 × 2分（每把T3最多得2分）
- **双上最大得分**: 剩余把数 × 3分（每把双上最多得3分）
- **预警条件**: 等级差距 > T3最大得分 且 等级差距 ≤ 双上最大得分

**预警提示**: "⚠️ 某方（落后方）再不双上，将追不上对方了！"

**提示方式**: 
- **Toast提示**: 在屏幕中央显示5秒的Toast消息
- **提示样式**: 警告图标，遮罩层背景，醒目显示
- **显示位置**: 屏幕中央，不遮挡重要游戏信息
- **自动消失**: 5秒后自动消失，无需用户操作

**例子**: 
- 东西方A（14级），南北方3级，剩余5把。T3最多追10分（3+10=13），双上最多追15分（3+15=18）。差距11分在10-15之间，预警："⚠️ 南北方再不双上，将追不上对方了！"
- 东西方K（13级），南北方2级，剩余5把。T3最多追10分（2+10=12），双上最多追15分（2+15=17）。差距11分在10-15之间，预警："⚠️ 南北方再不双上，将追不上对方了！"

## 五、游戏结束规则

### 5.1 成功过A
**触发条件**: 任何一方在到了A/A¹/A²，即当前一方的比分为A/A¹/A²或双方都为A/A¹/A²时，即在A阶段时，一方点击了双上或者T3（1游3游）按钮。

**结果**: 弹出提示："恭喜某方第N轮过A成功，本局结束"。此时，界面不清空，但不能继续比赛。

### 5.2 双方握手言和
**触发条件**: 双方比分相同。

**结果**: 弹出提示："双方握手言和，战平，本局结束"。此时，界面不清空，但不能继续比赛。

### 5.3 3A未过失败
**触发条件**: 任何一方到了A³。

**结果**: 弹出提示："某方3A未过，遗憾失去冠军"。此时，界面不清空，本把比赛的实时比分和历史记录比分不显示，只显示上把的记录。不能继续比赛。

### 5.4 到达把数胜负判定
**触发条件**: 达到预设的最大把数时。

**胜负判定规则**: 按照优先级顺序判定胜负：**A³ > A² > A¹ > A > K > Q > J > 10 > 9 > 8 > 7 > 6 > 5 > 4 > 3 > 2**

**结果**: 
- 如果双方等级不同，弹出提示："恭喜某方获胜，本局结束！"（某方等级更高）
- 如果双方等级相同，弹出提示："双方握手言和，战平，本局结束！"
- 此时，界面不清空，但不能继续比赛。

## 六、具体示例

### 6.1 追不上机制示例
- 东西方A，南北方10，剩余1把。南北方最多能得10+3=13分（K），无法追到A，东西方获胜。

### 6.2 追不上预警示例
- 东西方A，南北方10，剩余2把。南北方最多能得10+3+3=16分（A），刚好追到A，但需要连续两次双上。此时弹出预警："南北方再不获胜，将追不上对方了！"
- 东西方K，南北方7，剩余2把。南北方最多能得7+3+3=13分（K），刚好追到K，但需要连续两次双上。此时弹出预警："南北方再不获胜，将追不上对方了！"
- 东西方A²，南北方A，剩余2把。南北方最多能得A+3+3=A²，刚好追到A²，但需要连续两次双上。此时弹出预警："南北方再不获胜，将追不上对方了！"

### 6.3 到达把数胜负判定示例
- 东西方A²，南北方K → 东西方获胜（A² > K）
- 东西方A¹，南北方A → 东西方获胜（A¹ > A）
- 东西方A³，南北方A² → 东西方获胜（A³ > A²）
- 东西方A，南北方A → 双方握手言和

### 6.4 A阶段操作示例
- 本方A阶段点击T4（1游末游） → A→A¹
- 本方A¹阶段点击T4（1游末游） → A¹→A²
- 本方A²阶段点击T4（1游末游） → A²→A³（失败）
- 本方A/A¹/A²阶段点击双上或T3（1游3游） → 成功过A

## 七、游戏特性

### 7.1 把数制特色
- **时间限制**: 有明确的最大把数限制
- **公平性**: 即使没有过A，也能根据A阶段进度判定胜负
- **激励性**: 鼓励玩家在A阶段争取更高的状态
- **完整性**: 确保所有把数都有明确的胜负结果
- **预警机制**: 追不上预警通过Toast提示，提升游戏体验

### 7.2 界面状态
- 比赛严格按照预设把数进行
- 结束时保持当前界面状态，记录不被清空
- 不能继续比赛，但可以查看历史记录

---

📝 **文档版本**: v3.4  
📅 **创建时间**: 2024年12月19日  
📅 **更新时间**: 2025年9月27日  
👤 **负责人**: Jennifer  
🔄 **更新内容**: 
- 全面重新整理文档结构，使其更加规范精准
- A阶段规则与过A制规则保持一致，使用A¹、A²、A³标记
- 新增到达把数时的胜负判定功能，优先级：A³ > A² > A¹ > A > K > ... > 2
- 完善示例和说明，提高文档可读性和实用性
- 统一队伍名称：红方→东西方队，蓝方→南北方队
- 新增追不上预警机制：在追不上的前一把弹出预警提示
- 完善预警机制：剩余5把时触发，T3vs双上精准判断
- 优化预警信息：直接提示必须双上才能追上
- 明确预警提示方式：使用Toast提示，橙色背景，3-5秒自动消失