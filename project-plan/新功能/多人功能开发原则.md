# 掼蛋计分小程序 - 多人功能开发原则

## 🎯 核心开发原则

### **渐进式升级原则** ⭐ 最重要
> **"基于现有版本进行渐进式改造，确保用户使用连续性"**

#### 原则说明
- **保持现有布局**：用户熟悉的界面结构完全保留
- **最小化改动**：只在必要位置添加新功能入口
- **功能完整性**：现有单机功能完全保留，不受影响
- **用户连续性**：现有用户无需学习新界面，平滑过渡

#### 具体执行标准
1. **不新增独立页面**：优先使用弹窗、模态框等方式
2. **不修改现有样式**：只添加新样式，不修改现有CSS
3. **不改变现有逻辑**：现有功能逻辑完全保持不变
4. **不破坏现有交互**：现有按钮、操作方式完全保留

## 📋 开发执行标准

### 1. 界面改造标准

#### ✅ 允许的操作
- 在现有控制面板**添加**新按钮
- 在现有区域**添加**信息显示
- 使用**弹窗**方式展示新功能
- **扩展**现有数据结构

#### ❌ 禁止的操作
- 修改现有页面布局结构
- 改变现有按钮位置和样式
- 删除或替换现有功能
- 修改现有CSS类名和样式

### 2. 代码改造标准

#### ✅ 允许的操作
```javascript
// 在现有data中添加新字段
data: {
  // 现有数据完全不变
  levelTexts: { red: '2', blue: '2' },
  historyScores: [],
  
  // 新增数据
  isMultiMode: false,
  roomId: ''
}

// 添加新方法，不修改现有方法
onSelectMultiMode() {
  // 新功能逻辑
}

// 现有方法保持不变
onLevelUpgrade(e) {
  // 现有逻辑完全不变
}
```

#### ❌ 禁止的操作
```javascript
// 禁止修改现有方法
onLevelUpgrade(e) {
  // 不能在这里添加多人逻辑
  // 现有逻辑必须完全保留
}

// 禁止修改现有数据结构
data: {
  levelTexts: { red: '2', blue: '2' }, // 不能修改
  // 不能删除现有字段
}
```

### 3. 样式改造标准

#### ✅ 允许的操作
```css
/* 添加新样式类 */
.multi-mode-btn {
  /* 新样式 */
}

/* 使用条件样式 */
.player-name {
  /* 仅在多人模式显示 */
}
```

#### ❌ 禁止的操作
```css
/* 禁止修改现有样式 */
.team-btn {
  /* 不能修改现有按钮样式 */
}

.level-display {
  /* 不能修改现有分数显示样式 */
}
```

## 🎨 界面改造方案

### 阶段一：添加多人模式入口

#### 1. 主页改造
```xml
<!-- 现有布局完全不变 -->
<view class="container cn-paper-bg">
  <!-- 现有所有元素保持不变 -->
  
  <!-- 只在右侧控制面板添加按钮 -->
  <view class="right-control-panel">
    <!-- 现有按钮保持不变 -->
    <button class="start-btn" bindtap="onStartGame">开始游戏</button>
    
    <!-- 新增：多人模式按钮 -->
    <button class="multi-mode-btn" bindtap="onShowMultiMode">多人模式</button>
    
    <!-- 其他现有功能保持不变 -->
  </view>
</view>
```

#### 2. 多人模式选择弹窗
```xml
<!-- 新增弹窗，不影响现有布局 -->
<view class="multi-mode-modal" wx:if="{{showMultiMode}}">
  <view class="modal-overlay" bindtap="onCloseMultiMode"></view>
  <view class="modal-content">
    <!-- 模式选择内容 -->
  </view>
</view>
```

### 阶段二：集成房间功能

#### 1. 房间信息显示
```xml
<!-- 在现有品牌标识区域添加房间信息 -->
<view class="brand-section">
  <!-- 现有内容保持不变 -->
  <view class="brand-logo">...</view>
  
  <!-- 新增：房间信息（仅多人模式显示） -->
  <view class="room-info" wx:if="{{isMultiMode}}">
    <text class="room-id">房间: {{roomId}}</text>
    <text class="player-count">{{playerCount}}/4人</text>
  </view>
  
  <!-- 现有环境标识保持不变 -->
  <view class="env-badge">...</view>
</view>
```

#### 2. 玩家信息显示
```xml
<!-- 在现有队伍区域添加玩家昵称 -->
<view class="score-container">
  <!-- 现有队伍标签保持不变 -->
  <text class="team-label">东西方</text>
  
  <!-- 新增：玩家昵称（仅多人模式显示） -->
  <view class="player-names" wx:if="{{isMultiMode}}">
    <text class="player-name">{{redPlayers[0]}}</text>
    <text class="player-name">{{redPlayers[1]}}</text>
  </view>
  
  <!-- 现有分数显示保持不变 -->
  <view class="level-display">...</view>
</view>
```

## 🔄 功能切换逻辑

### 模式切换实现
```javascript
// 选择单机模式（现有功能完全不变）
onSelectSingleMode() {
  this.setData({
    isMultiMode: false,
    showMultiMode: false
  });
  // 现有单机功能逻辑完全不变
},

// 选择多人模式（新功能）
onSelectMultiMode() {
  this.setData({
    isMultiMode: true,
    showMultiMode: false
  });
  // 显示房间创建选项
  this.showRoomOptions();
}
```

### 数据流设计
```javascript
// 现有数据结构保持不变
data: {
  // 现有所有数据...
  levelTexts: { red: '2', blue: '2' },
  historyScores: [],
  rule: 'by-rounds',
  
  // 新增多人模式数据
  isMultiMode: false,
  showMultiMode: false,
  roomId: '',
  playerCount: 1,
  redPlayers: ['玩家1', '玩家2'],
  bluePlayers: ['玩家3', '玩家4']
}
```

## 📊 测试验证标准

### 1. 现有功能测试
- ✅ 单机模式所有功能正常工作
- ✅ 现有按钮和交互完全不变
- ✅ 现有样式和布局完全不变
- ✅ 现有数据逻辑完全不变

### 2. 新功能测试
- ✅ 多人模式入口正常显示
- ✅ 模式切换功能正常
- ✅ 房间功能不影响现有功能
- ✅ 新功能可以独立关闭

### 3. 兼容性测试
- ✅ 现有用户升级后无学习成本
- ✅ 现有数据完全兼容
- ✅ 现有操作习惯完全保留

## 🎯 团队执行要求

### 开发人员要求
1. **严格遵守**渐进式升级原则
2. **优先考虑**现有功能不受影响
3. **最小化改动**，只添加必要功能
4. **充分测试**现有功能完整性

### 测试人员要求
1. **重点测试**现有功能是否受影响
2. **验证**用户连续性体验
3. **确保**新功能可以独立关闭
4. **检查**界面一致性

### 产品人员要求
1. **监督**渐进式升级原则执行
2. **确保**用户体验连续性
3. **平衡**新功能与现有功能
4. **收集**用户反馈

## 📝 执行检查清单

### 开发前检查
- [ ] 是否修改了现有页面布局？
- [ ] 是否修改了现有CSS样式？
- [ ] 是否修改了现有JavaScript逻辑？
- [ ] 是否删除了现有功能？

### 开发中检查
- [ ] 现有功能是否完全保留？
- [ ] 新功能是否使用弹窗方式？
- [ ] 是否只添加了新的数据字段？
- [ ] 是否只添加了新的方法？

### 开发后检查
- [ ] 现有用户是否无需学习？
- [ ] 现有操作是否完全不变？
- [ ] 新功能是否可以独立关闭？
- [ ] 界面是否保持一致性？

## 🚨 违规处理

### 违规类型
1. **严重违规**：修改现有页面布局结构
2. **中等违规**：修改现有CSS样式
3. **轻微违规**：修改现有JavaScript逻辑

### 处理措施
1. **立即回滚**：发现违规立即回滚代码
2. **重新设计**：按照渐进式原则重新设计
3. **团队讨论**：必要时团队讨论解决方案

---

## 📋 更新记录

- **2025-09-28**: 初始版本，基于Annie建议制定渐进式升级原则
- **待更新**: 根据开发过程中的实际情况调整

---

**开发原则版本**: v1.0  
**制定时间**: 2025-09-28  
**制定者**: Maius (前端开发助手)  
**审核者**: Annie (技术开发) + qjl (产品负责人)  
**执行团队**: 全体开发团队


