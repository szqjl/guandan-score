# 掼蛋计分小程序 - 房间创建界面设计方案

**设计时间**：2025-09-28  
**设计目标**：创建流畅、直观的房间创建体验  
**设计原则**：简化流程、灵活加入、用户体验优先  

---

## 📋 **设计概述**

### **核心设计理念**
- **一键创建**：点击"创建比赛"直接获取微信昵称，无需填写表单
- **座位选择**：房主选择座位，其他座位自动填充默认昵称
- **队伍绑定**：东、西座位绑定东西方队伍，南、北座位绑定南北方队伍
- **灵活加入**：支持扫码、分享、默认昵称多种加入方式
- **直观管理**：清晰的座位选择界面，房主可编辑玩家信息
- **成本控制**：简化操作流程，减少云函数调用

### **设计目标**
1. 简化房主操作步骤
2. 提供灵活的玩家加入方式
3. 直观的座位管理界面
4. 清晰的队伍绑定逻辑
5. 保持现有设计风格

---

## 🎨 **界面设计方案**

### **主页按钮布局**

#### **右侧控制面板**
```xml
<view class="right-control-panel">
  <!-- 单人模式 -->
  <button class="start-btn" bindtap="onStartSingleGame">开始游戏</button>
  
  <!-- 多人模式 -->
  <button class="create-btn" bindtap="onCreateMatch">创建比赛</button>
  
  <!-- 其他功能 -->
  <button class="history-btn" bindtap="onShowHistory">历史记录</button>
  <button class="settings-btn" bindtap="onShowSettings">设置</button>
</view>
```

### **房间页面设计**

#### **整体布局**
- **顶部**：房间信息（房间号、比赛模式）
- **中部**：4人座位网格（2x2布局，东、西、南、北）
- **底部**：操作按钮（开始比赛、分享房间）

#### **座位布局**
```
┌─────────┬─────────┐
│   北    │   东    │
│  (北恋) │(旭日东升)│
├─────────┼─────────┤
│   西    │   南    │
│(西风斜阳)│  (南尊)  │
└─────────┴─────────┘
```

#### **队伍绑定**
- **东西方队伍**：东座玩家 + 西座玩家
- **南北方队伍**：南座玩家 + 北座玩家

#### **房间页面结构**
```xml
<view class="room-page">
  <!-- 头部信息 -->
  <view class="room-header">
    <view class="room-info">
      <text class="room-title">房间号：{{roomId}}</text>
      <text class="room-mode">{{gameModeText}}</text>
    </view>
    <button class="close-btn" bindtap="onLeaveRoom">离开</button>
  </view>
  
  <!-- 房间二维码 -->
  <view class="qr-section">
    <view class="qr-code">
      <image src="{{qrCodeUrl}}" class="qr-image" />
      <text class="qr-tip">扫码加入比赛</text>
    </view>
    <button class="share-btn" bindtap="onShareRoom">分享房间</button>
  </view>
  
  <!-- 玩家座位 -->
  <view class="players-section">
    <view class="players-title">玩家座位（4人）</view>
    <view class="players-grid">
      <!-- 北座 -->
      <view class="player-seat north-seat">
        <view class="seat-content {{seats.north.isHost ? 'host-seat' : ''}}">
          <view class="seat-avatar">
            <image wx:if="{{seats.north.avatar}}" src="{{seats.north.avatar}}" />
            <text wx:else class="default-avatar">{{seats.north.playerName ? seats.north.playerName.charAt(0) : '北'}}</text>
          </view>
          <view class="player-info">
            <text class="player-name">{{seats.north.playerName || '北恋'}}</text>
            <text wx:if="{{seats.north.isHost}}" class="host-badge">房主</text>
            <text wx:if="{{!seats.north.isHost && !seats.north.playerName}}" class="default-badge">默认队友</text>
          </view>
          <button wx:if="{{isHost && !seats.north.isHost}}" 
            class="edit-btn" 
            bindtap="onEditPlayer" 
            data-seat="north">
            编辑
          </button>
        </view>
      </view>
      
      <!-- 东座 -->
      <view class="player-seat east-seat">
        <view class="seat-content {{seats.east.isHost ? 'host-seat' : ''}}">
          <view class="seat-avatar">
            <image wx:if="{{seats.east.avatar}}" src="{{seats.east.avatar}}" />
            <text wx:else class="default-avatar">{{seats.east.playerName ? seats.east.playerName.charAt(0) : '东'}}</text>
          </view>
          <view class="player-info">
            <text class="player-name">{{seats.east.playerName || '旭日东升'}}</text>
            <text wx:if="{{seats.east.isHost}}" class="host-badge">房主</text>
            <text wx:if="{{!seats.east.isHost && !seats.east.playerName}}" class="default-badge">默认队友</text>
          </view>
          <button wx:if="{{isHost && !seats.east.isHost}}" 
            class="edit-btn" 
            bindtap="onEditPlayer" 
            data-seat="east">
            编辑
          </button>
        </view>
      </view>
      
      <!-- 西座 -->
      <view class="player-seat west-seat">
        <view class="seat-content {{seats.west.isHost ? 'host-seat' : ''}}">
          <view class="seat-avatar">
            <image wx:if="{{seats.west.avatar}}" src="{{seats.west.avatar}}" />
            <text wx:else class="default-avatar">{{seats.west.playerName ? seats.west.playerName.charAt(0) : '西'}}</text>
          </view>
          <view class="player-info">
            <text class="player-name">{{seats.west.playerName || '西风斜阳'}}</text>
            <text wx:if="{{seats.west.isHost}}" class="host-badge">房主</text>
            <text wx:if="{{!seats.west.isHost && !seats.west.playerName}}" class="default-badge">默认队友</text>
          </view>
          <button wx:if="{{isHost && !seats.west.isHost}}" 
            class="edit-btn" 
            bindtap="onEditPlayer" 
            data-seat="west">
            编辑
          </button>
        </view>
      </view>
      
      <!-- 南座 -->
      <view class="player-seat south-seat">
        <view class="seat-content {{seats.south.isHost ? 'host-seat' : ''}}">
          <view class="seat-avatar">
            <image wx:if="{{seats.south.avatar}}" src="{{seats.south.avatar}}" />
            <text wx:else class="default-avatar">{{seats.south.playerName ? seats.south.playerName.charAt(0) : '南'}}</text>
          </view>
          <view class="player-info">
            <text class="player-name">{{seats.south.playerName || '南尊'}}</text>
            <text wx:if="{{seats.south.isHost}}" class="host-badge">房主</text>
            <text wx:if="{{!seats.south.isHost && !seats.south.playerName}}" class="default-badge">默认队友</text>
          </view>
          <button wx:if="{{isHost && !seats.south.isHost}}" 
            class="edit-btn" 
            bindtap="onEditPlayer" 
            data-seat="south">
            编辑
          </button>
        </view>
      </view>
    </view>
  </view>
  
  <!-- 操作按钮 -->
  <view class="action-buttons">
    <button class="start-btn" bindtap="onStartGame" 
      disabled="{{!canStartGame}}">
      开始比赛
    </button>
  </view>
</view>
```

---

## 🔧 **技术实现方案**

### **设置页面功能扩展**

#### **新增设置项**
```javascript
// 设置页面数据结构
data: {
  // 现有功能
  redPlayers: ['东西方队1号', '东西方队2号'],
  bluePlayers: ['南北方队1号', '南北方队2号'],
  
  // 新增功能
  defaultGameMode: 'guoA', // 默认比赛模式
  defaultPlayerNames: {
    east: '旭日东升',    // 东座默认昵称
    west: '西风斜阳',    // 西座默认昵称
    south: '南尊',       // 南座默认昵称
    north: '北恋'        // 北座默认昵称
  }
}
```

#### **设置页面布局**
```xml
<view class="settings-container">
  <!-- 默认比赛模式 -->
  <view class="settings-section">
    <text class="section-title">默认比赛模式</text>
    <view class="mode-options">
      <view class="mode-option {{defaultGameMode === 'guoA' ? 'selected' : ''}}" 
            data-mode="guoA" bindtap="onGameModeChange">
        <text class="mode-text">过A制</text>
        <text class="mode-desc">从2到A的升级路径</text>
      </view>
      <view class="mode-option {{defaultGameMode === 'baShu' ? 'selected' : ''}}" 
            data-mode="baShu" bindtap="onGameModeChange">
        <text class="mode-text">把数制</text>
        <text class="mode-desc">固定把数内计分</text>
      </view>
    </view>
  </view>

  <!-- 队员姓名设置（现有功能） -->
  <view class="settings-section">
    <text class="section-title">队员姓名设置</text>
    <!-- 现有队员设置代码 -->
  </view>

  <!-- 默认队友昵称设置 -->
  <view class="settings-section">
    <text class="section-title">默认队友昵称</text>
    <view class="default-names-grid">
      <view class="name-input-group">
        <text class="seat-label">东座：</text>
        <input class="name-input" value="{{defaultPlayerNames.east}}" 
               bindinput="onDefaultNameInput" data-seat="east" maxlength="10" />
      </view>
      <view class="name-input-group">
        <text class="seat-label">西座：</text>
        <input class="name-input" value="{{defaultPlayerNames.west}}" 
               bindinput="onDefaultNameInput" data-seat="west" maxlength="10" />
      </view>
      <view class="name-input-group">
        <text class="seat-label">南座：</text>
        <input class="name-input" value="{{defaultPlayerNames.south}}" 
               bindinput="onDefaultNameInput" data-seat="south" maxlength="10" />
      </view>
      <view class="name-input-group">
        <text class="seat-label">北座：</text>
        <input class="name-input" value="{{defaultPlayerNames.north}}" 
               bindinput="onDefaultNameInput" data-seat="north" maxlength="10" />
      </view>
    </view>
  </view>
</view>
```

### **房间页面数据模型**
```javascript
data: {
  // 房间信息
  roomId: '',
  gameMode: 'guoA',
  gameModeText: '过A制',
  qrCodeUrl: '',
  
  // 玩家座位（按方向组织）
  seats: {
    north: { playerName: '北恋', avatar: '', isHost: false },
    east: { playerName: '旭日东升', avatar: '', isHost: false },
    west: { playerName: '西风斜阳', avatar: '', isHost: false },
    south: { playerName: '南尊', avatar: '', isHost: false }
  },
  
  // 房主信息
  isHost: true,
  hostSeat: 'east', // 房主选择的座位
  
  // 队伍绑定
  teams: {
    eastWest: ['east', 'west'], // 东西方队伍
    southNorth: ['south', 'north'] // 南北方队伍
  },
  
  // 游戏状态
  canStartGame: false,
  
  // 用户偏好
  userPreferences: {
    gameMode: 'guoA',
    hostName: '',
    defaultPlayerNames: {
      east: '旭日东升',
      west: '西风斜阳', 
      south: '南尊',
      north: '北恋'
    }
  }
}
```

### **核心方法实现**

#### **设置页面方法**
```javascript
// 比赛模式选择
onGameModeChange(e) {
  const mode = e.currentTarget.dataset.mode;
  this.setData({
    defaultGameMode: mode
  });
},

// 默认昵称输入
onDefaultNameInput(e) {
  const seat = e.currentTarget.dataset.seat;
  const value = e.detail.value;
  this.setData({
    [`defaultPlayerNames.${seat}`]: value
  });
},

// 保存设置
onSaveSettings() {
  // 保存到本地存储
  wx.setStorageSync('userSettings', {
    defaultGameMode: this.data.defaultGameMode,
    defaultPlayerNames: this.data.defaultPlayerNames,
    redPlayers: this.data.redPlayers,
    bluePlayers: this.data.bluePlayers
  });
  
  wx.showToast({
    title: '保存成功',
    icon: 'success'
  });
  
  setTimeout(() => {
    wx.navigateBack();
  }, 1500);
}
```

#### **创建比赛（简化流程）**
```javascript
// 创建比赛（一键创建）
onCreateMatch() {
  // 显示加载状态
  wx.showLoading({
    title: '创建中...'
  });
  
  // 自动获取微信昵称
  wx.getUserProfile({
    desc: '用于显示您的昵称',
    success: (res) => {
      this.createRoomWithNickname(res.userInfo.nickName);
    },
    fail: (err) => {
      console.log('获取用户信息失败:', err);
      // 使用默认昵称
      this.createRoomWithNickname('房主');
    }
  });
},

// 使用昵称创建房间
createRoomWithNickname(nickname) {
  // 获取用户偏好
  const userSettings = wx.getStorageSync('userSettings') || {};
  const gameMode = userSettings.defaultGameMode || 'guoA';
  const defaultNames = userSettings.defaultPlayerNames || {
    east: '旭日东升',
    west: '西风斜阳',
    south: '南尊',
    north: '北恋'
  };
  
  const roomName = this.generateRoomName();
  
  // 调用云函数创建房间
  wx.cloud.callFunction({
    name: 'roomManager',
    data: {
      action: 'createRoom',
      data: {
        roomName: roomName,
        hostName: nickname,
        gameMode: gameMode,
        defaultPlayerNames: defaultNames
      }
    }
  }).then(res => {
    wx.hideLoading();
    
    if (res.result.success) {
      // 直接跳转到房间页面
      wx.navigateTo({
        url: `/pages/room/index?roomId=${res.result.data.roomId}&isHost=true&hostSeat=east`
      });
    } else {
      wx.showToast({
        title: res.result.message || '创建失败',
        icon: 'error'
      });
    }
  }).catch(err => {
    wx.hideLoading();
    console.error('创建房间失败:', err);
    wx.showToast({
      title: '网络错误，请重试',
      icon: 'error'
    });
  });
}
```

#### **玩家管理**
```javascript
// 编辑玩家昵称
onEditPlayer(e) {
  const seat = e.currentTarget.dataset.seat;
  const currentName = this.data.seats[seat].playerName;
  
  wx.showModal({
    title: '修改玩家昵称',
    editable: true,
    placeholderText: '请输入玩家昵称',
    content: currentName,
    success: (res) => {
      if (res.confirm && res.content) {
        this.updatePlayerName(seat, res.content);
      }
    }
  });
},

// 更新玩家昵称
updatePlayerName(seat, newName) {
  this.setData({
    [`seats.${seat}.playerName`]: newName
  });
  
  // 调用云函数更新房间信息
  wx.cloud.callFunction({
    name: 'roomManager',
    data: {
      action: 'updatePlayerName',
      data: {
        roomId: this.data.roomId,
        seat: seat,
        playerName: newName
      }
    }
  });
}
```

#### **队伍绑定逻辑**
```javascript
// 获取队伍信息
getTeamInfo() {
  const seats = this.data.seats;
  return {
    eastWest: {
      players: [seats.east.playerName, seats.west.playerName],
      teamName: '东西方'
    },
    southNorth: {
      players: [seats.south.playerName, seats.north.playerName],
      teamName: '南北方'
    }
  };
},

// 开始比赛
onStartGame() {
  const teamInfo = this.getTeamInfo();
  
  // 跳转到游戏页面，传递队伍信息
  wx.navigateTo({
    url: `/pages/game/index?roomId=${this.data.roomId}&teams=${JSON.stringify(teamInfo)}`
  });
}
```

#### **用户偏好管理**
```javascript
// 用户偏好存储管理
const UserPreferences = {
  // 保存游戏模式偏好
  saveGameMode(mode) {
    wx.setStorageSync('defaultGameMode', mode);
  },
  
  // 获取游戏模式偏好
  getGameMode() {
    return wx.getStorageSync('defaultGameMode') || 'guoA';
  },
  
  // 保存默认昵称
  saveDefaultNames(names) {
    wx.setStorageSync('defaultPlayerNames', names);
  },
  
  // 获取默认昵称
  getDefaultNames() {
    return wx.getStorageSync('defaultPlayerNames') || {
      east: '旭日东升',
      west: '西风斜阳',
      south: '南尊',
      north: '北恋'
    };
  }
};
```

---

## 🎨 **样式设计规范**

### **房间页面样式**
```css
.room-page {
  min-height: 100vh;
  background: #F8F8F8;
  padding: 20rpx;
}

.room-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20rpx;
  background: white;
  border-radius: 12rpx;
  margin-bottom: 20rpx;
}

.room-title {
  font-size: 18rpx;
  font-weight: 600;
  color: #333;
}

.room-mode {
  font-size: 12rpx;
  color: #666;
  margin-top: 5rpx;
}

.close-btn {
  width: 60rpx;
  height: 60rpx;
  border: none;
  background: #F0F0F0;
  border-radius: 50%;
  font-size: 20rpx;
  color: #999;
}
```

### **二维码区域样式**
```css
.qr-section {
  background: white;
  border-radius: 12rpx;
  padding: 30rpx;
  text-align: center;
  margin-bottom: 20rpx;
}

.qr-code {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15rpx;
}

.qr-image {
  width: 200rpx;
  height: 200rpx;
  border: 1rpx solid #E0E0E0;
  border-radius: 8rpx;
}

.qr-tip {
  font-size: 12rpx;
  color: #666;
}

.share-btn {
  background: #4CAF50;
  color: white;
  border: none;
  padding: 15rpx 30rpx;
  border-radius: 8rpx;
  font-size: 14rpx;
  margin-top: 20rpx;
}
```

### **玩家座位样式**
```css
.players-section {
  background: white;
  border-radius: 12rpx;
  padding: 30rpx;
  margin-bottom: 20rpx;
}

.players-title {
  font-size: 16rpx;
  font-weight: 600;
  color: #333;
  margin-bottom: 20rpx;
}

.players-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 20rpx;
}

.player-seat {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20rpx;
  border: 2rpx solid #E0E0E0;
  border-radius: 12rpx;
  background: #F8F8F8;
  position: relative;
}

.host-seat {
  border-color: #2196F3;
  background: #E3F2FD;
}

.seat-avatar {
  width: 80rpx;
  height: 80rpx;
  border-radius: 50%;
  background: #E0E0E0;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 15rpx;
  overflow: hidden;
}

.seat-avatar image {
  width: 100%;
  height: 100%;
}

.default-avatar {
  font-size: 24rpx;
  color: #999;
}

.player-info {
  text-align: center;
  margin-bottom: 10rpx;
}

.player-name {
  display: block;
  font-size: 14rpx;
  font-weight: 500;
  color: #333;
  margin-bottom: 5rpx;
}

.host-badge {
  font-size: 10rpx;
  color: #2196F3;
  background: #E3F2FD;
  padding: 2rpx 6rpx;
  border-radius: 4rpx;
}

.default-badge {
  font-size: 10rpx;
  color: #FF9800;
  background: #FFF3E0;
  padding: 2rpx 6rpx;
  border-radius: 4rpx;
}

.edit-btn {
  position: absolute;
  top: 10rpx;
  right: 10rpx;
  width: 40rpx;
  height: 40rpx;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 12rpx;
}
```

### **操作按钮样式**
```css
.action-buttons {
  padding: 20rpx;
  background: white;
  border-radius: 12rpx;
}

.start-btn {
  width: 100%;
  height: 80rpx;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 12rpx;
  font-size: 16rpx;
  font-weight: 600;
}

.start-btn:disabled {
  background: #CCCCCC;
  color: #999;
}
```

---

## 🔄 **交互流程设计**

### **完整用户流程**
1. **触发创建**：用户点击"创建比赛"按钮
2. **自动获取**：自动获取微信昵称，显示加载状态
3. **创建房间**：调用云函数创建房间，使用用户偏好设置
4. **跳转房间**：直接跳转到房间页面，显示房间信息
5. **座位管理**：房主可编辑玩家昵称，其他玩家可扫码加入
6. **开始游戏**：点击"开始比赛"跳转到游戏页面

### **玩家加入方式**
1. **扫码加入**：扫描二维码，自动获取微信昵称
2. **分享加入**：通过分享链接加入房间
3. **默认昵称**：直接使用预设的默认队友昵称

### **错误处理流程**
1. **获取昵称失败**：使用默认昵称"玩家1"
2. **创建房间失败**：显示错误提示，允许重试
3. **网络错误**：显示网络错误提示，提供重试选项

---

## 📱 **响应式适配**

### **横屏模式（主要）**
```css
@media screen and (orientation: landscape) {
  .players-grid {
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: 1fr;
  }
  
  .qr-section {
    display: flex;
    align-items: center;
    gap: 30rpx;
  }
  
  .qr-code {
    flex-direction: row;
  }
}
```

### **竖屏模式（兼容）**
```css
@media screen and (orientation: portrait) {
  .players-grid {
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
  }
  
  .qr-section {
    flex-direction: column;
  }
}
```

---

## 🎯 **设计优势**

### **用户体验优势**
1. **一键创建**：点击"创建比赛"直接进入房间，无需填写表单
2. **灵活加入**：支持扫码、分享、默认昵称多种加入方式
3. **直观管理**：清晰的座位选择界面，房主可编辑玩家信息
4. **操作简化**：减少用户操作步骤，提升使用效率

### **技术优势**
1. **成本控制**：简化操作流程，减少云函数调用
2. **性能优化**：本地状态管理，减少网络请求
3. **错误处理**：完善的异常处理和降级方案
4. **可维护性**：清晰的代码结构和组件化设计

### **业务优势**
1. **用户留存**：流畅的体验提升用户满意度
2. **功能完整**：一次实现所有核心功能
3. **扩展性**：为后续功能扩展预留空间
4. **兼容性**：保持与现有功能的兼容性

---

## 📋 **实施计划**

### **第一阶段：基础房间页面**
- [ ] 实现房间页面结构
- [ ] 添加房间信息显示
- [ ] 实现二维码生成和显示
- [ ] 添加基础样式

### **第二阶段：座位管理**
- [ ] 实现4人座位网格布局
- [ ] 添加玩家信息显示
- [ ] 实现房主编辑功能
- [ ] 添加座位状态管理

### **第三阶段：创建功能**
- [ ] 实现一键创建比赛
- [ ] 集成云函数调用
- [ ] 添加用户偏好管理
- [ ] 实现错误处理

### **第四阶段：玩家加入**
- [ ] 实现扫码加入功能
- [ ] 添加分享房间功能
- [ ] 实现默认昵称加入
- [ ] 完善状态同步

### **第五阶段：测试优化**
- [ ] 功能测试和bug修复
- [ ] 性能优化和体验调优
- [ ] 响应式适配测试
- [ ] 用户反馈收集和优化

---

**设计方案版本**: v2.0  
**最后更新**: 2025-09-28  
**设计者**: Maius (前端开发助手)  
**审核者**: qjl (产品负责人)

---

## 🚀 **下一步行动**

1. **确认设计方案**：与产品负责人确认设计细节
2. **开始开发实施**：按照实施计划逐步开发
3. **测试验证**：每个阶段完成后进行测试
4. **用户反馈**：收集用户反馈并持续优化

## 📝 **设计变更记录**

### **v2.0 主要变更**
- **简化创建流程**：从弹窗表单改为一键创建
- **优化用户体验**：减少操作步骤，提升使用效率
- **灵活加入方式**：支持扫码、分享、默认昵称多种方式
- **直观座位管理**：清晰的4人座位界面，房主可编辑
- **用户偏好设置**：记住用户选择，减少重复操作

### **核心改进**
1. **一键创建**：点击"创建比赛"直接获取微信昵称并创建房间
2. **直接跳转**：创建成功后直接跳转到房间页面，无需弹窗展开
3. **灵活加入**：其他玩家可选择扫码、分享或使用默认昵称
4. **座位管理**：房主可编辑玩家昵称，支持默认队友策略
5. **偏好记忆**：记住用户选择的比赛模式，提升使用体验

这个优化后的设计方案更符合实际使用场景，简化了操作流程，提升了用户体验！
