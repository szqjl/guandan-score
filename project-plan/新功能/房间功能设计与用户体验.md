# 掼蛋计分小程序 - 房间功能设计与用户体验

**设计时间**：2025-09-28  
**最后更新**：2025-10-01  
**设计目标**：创建流畅、直观的房间创建和管理体验  
**设计原则**：简化流程、灵活加入、用户体验优先  

---

## 📋 设计概述

### 核心设计理念
- **一键创建**：点击"创建比赛"直接获取微信昵称，无需填写表单
- **座位选择**：房主选择座位，其他座位自动填充默认昵称
- **队伍绑定**：东、西座位绑定东西方队伍，南、北座位绑定南北方队伍
- **灵活加入**：支持扫码、分享、默认昵称多种加入方式
- **直观管理**：清晰的座位选择界面，房主可编辑玩家信息
- **成本控制**：简化操作流程，减少云函数调用

---

## 🎨 界面设计方案

### 主页按钮布局

#### 右侧控制面板
```xml
<view class="right-control-panel">
  <!-- 单人模式 -->
  <button class="start-btn" bindtap="onStartSingleGame">开始游戏</button>
  
  <!-- 多人模式 -->
  <button class="create-btn" bindtap="onCreateMatch">创建比赛</button>
  
  <!-- 其他功能 -->
  <button class="history-btn" bindtap="onShowHistory">历史记录</button>
  <button class="settings-btn" bindtap="onShowSettings">设置</button>
</view>
```

---

### 房间页面设计

#### 整体布局
- **顶部**：房间信息（房间号、比赛模式）
- **中部**：4人座位网格（2x2布局，东、西、南、北）
- **底部**：操作按钮（开始比赛、分享房间）

#### 座位布局
```
┌─────────┬─────────┐
│   北    │   东    │
│  (北恋) │(旭日东升)│
├─────────┼─────────┤
│   西    │   南    │
│(西风斜阳)│  (南尊)  │
└─────────┴─────────┘
```

#### 队伍绑定
- **东西方队伍**：东座玩家 + 西座玩家
- **南北方队伍**：南座玩家 + 北座玩家

---

### 房间页面结构
```xml
<view class="room-page">
  <!-- 头部信息 -->
  <view class="room-header">
    <view class="room-info">
      <text class="room-title">房间号：{{roomId}}</text>
      <text class="room-mode">{{gameModeText}}</text>
    </view>
    <button class="close-btn" bindtap="onLeaveRoom">离开</button>
  </view>
  
  <!-- 房间二维码 -->
  <view class="qr-section">
    <view class="qr-code">
      <image src="{{qrCodeUrl}}" class="qr-image" />
      <text class="qr-tip">扫码加入比赛</text>
    </view>
    <button class="share-btn" bindtap="onShareRoom">分享房间</button>
  </view>
  
  <!-- 玩家座位 -->
  <view class="players-section">
    <view class="players-title">玩家座位（4人）</view>
    <view class="players-grid">
      <!-- 座位网格 -->
    </view>
  </view>
  
  <!-- 操作按钮 -->
  <view class="action-buttons">
    <button class="start-btn" bindtap="onStartGame">开始比赛</button>
  </view>
</view>
```

---

### 房间页面数据模型
```javascript
data: {
  // 房间信息
  roomId: '',
  gameMode: 'guoA',
  gameModeText: '过A制',
  qrCodeUrl: '',
  
  // 玩家座位（按方向组织）
  seats: {
    north: { playerName: '北恋', avatar: '', isHost: false },
    east: { playerName: '旭日东升', avatar: '', isHost: false },
    west: { playerName: '西风斜阳', avatar: '', isHost: false },
    south: { playerName: '南尊', avatar: '', isHost: false }
  },
  
  // 房主信息
  isHost: true,
  hostSeat: 'east', // 房主选择的座位
  
  // 队伍绑定
  teams: {
    eastWest: ['east', 'west'], // 东西方队伍
    southNorth: ['south', 'north'] // 南北方队伍
  },
  
  // 游戏状态
  canStartGame: false
}
```

---

## 🎯 用户体验设计

### 操作流程设计

#### 完整用户流程
```
1. 触发创建：用户点击"创建比赛"按钮
   ↓
2. 自动获取：自动获取微信昵称，显示加载状态
   ↓
3. 创建房间：调用云函数创建房间，使用用户偏好设置
   ↓
4. 跳转房间：直接跳转到房间页面，显示房间信息
   ↓
5. 座位管理：房主可编辑玩家昵称，其他玩家可扫码加入
   ↓
6. 开始游戏：点击"开始比赛"跳转到游戏页面
```

#### 玩家加入方式
1. **扫码加入**：扫描二维码，自动获取微信昵称
2. **分享加入**：通过分享链接加入房间
3. **默认昵称**：直接使用预设的默认队友昵称

---

### 状态提示设计

让用户心中有数，避免困惑。

| 状态 | 提示方式 | 具体设计 |
|------|---------|---------|
| **等待加入** | 页面标题 + 视觉设计 | 准备页标题为"等待加入..."。空座位显示为虚位以待的灰色图标。 |
| **游戏中** | 动态元素 + 文字 | 计分页标题显示"计分中"。比分牌有轻微脉冲动画。 |
| **网络连接中** | 全局轻提示 | 网络不稳定时，顶部出现提示条："网络连接中..."，连接恢复后显示"已重新连接"。 |
| **数据同步** | 按钮状态 + 轻提示 | 点击得分按钮后，按钮变为禁用状态并显示"同步中..."，同步成功后恢复。 |

---

### 错误处理设计

错误处理的核心是**告知用户发生了什么、为什么发生、以及他们能做什么**。

| 错误场景 | 前端检测与处理 | 用户看到的反馈 |
|---------|---------------|---------------|
| **网络异常** | 云函数调用失败 | Toast提示："网络开小差了，请检查网络设置。"<br>所有操作按钮变为不可点击状态，显示"重试"按钮。 |
| **房间已满员** | joinRoom云函数返回错误码 | Modal对话框：<br>**标题**：无法加入<br>**内容**：这个房间已经满员了（4/4）<br>**按钮**："知道啦" |
| **房间不存在** | 云函数返回错误码 | Modal对话框：<br>**标题**：房间不存在<br>**内容**：可能房间号错误，或比赛已经结束了<br>**按钮**："返回首页" |
| **操作冲突** | 前端根据权限判断 | Toast提示："只有房主可以计分哦~" |

---

## 🔧 技术实现方案

### 创建比赛（简化流程）
```javascript
// 创建比赛（一键创建）
onCreateMatch() {
  wx.showLoading({ title: '创建中...' });
  
  // 自动获取微信昵称
  wx.getUserProfile({
    desc: '用于显示您的昵称',
    success: (res) => {
      this.createRoomWithNickname(res.userInfo.nickName);
    },
    fail: (err) => {
      // 使用默认昵称
      this.createRoomWithNickname('房主');
    }
  });
}
```

### 玩家管理
```javascript
// 编辑玩家昵称
onEditPlayer(e) {
  const seat = e.currentTarget.dataset.seat;
  const currentName = this.data.seats[seat].playerName;
  
  wx.showModal({
    title: '修改玩家昵称',
    editable: true,
    placeholderText: '请输入玩家昵称',
    content: currentName,
    success: (res) => {
      if (res.confirm && res.content) {
        this.updatePlayerName(seat, res.content);
      }
    }
  });
}

// 更新玩家昵称
updatePlayerName(seat, newName) {
  this.setData({
    [`seats.${seat}.playerName`]: newName
  });
  
  // 调用云函数更新房间信息
  wx.cloud.callFunction({
    name: 'roomManager',
    data: {
      action: 'updatePlayerName',
      data: {
        roomId: this.data.roomId,
        seat: seat,
        playerName: newName
      }
    }
  });
}
```

### 队伍绑定逻辑
```javascript
// 获取队伍信息
getTeamInfo() {
  const seats = this.data.seats;
  return {
    eastWest: {
      players: [seats.east.playerName, seats.west.playerName],
      teamName: '东西方'
    },
    southNorth: {
      players: [seats.south.playerName, seats.north.playerName],
      teamName: '南北方'
    }
  };
}

// 开始比赛
onStartGame() {
  const teamInfo = this.getTeamInfo();
  
  // 跳转到游戏页面，传递队伍信息
  wx.navigateTo({
    url: `/pages/game/index?roomId=${this.data.roomId}&teams=${JSON.stringify(teamInfo)}`
  });
}
```

---

## 🎨 样式设计规范

### 房间页面样式
```css
.room-page {
  min-height: 100vh;
  background: #F8F8F8;
  padding: 20rpx;
}

.room-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20rpx;
  background: white;
  border-radius: 12rpx;
  margin-bottom: 20rpx;
}

.room-title {
  font-size: 18rpx;
  font-weight: 600;
  color: #333;
}
```

### 二维码区域样式
```css
.qr-section {
  background: white;
  border-radius: 12rpx;
  padding: 30rpx;
  text-align: center;
  margin-bottom: 20rpx;
}

.qr-image {
  width: 200rpx;
  height: 200rpx;
  border: 1rpx solid #E0E0E0;
  border-radius: 8rpx;
}
```

### 玩家座位样式
```css
.players-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 20rpx;
}

.player-seat {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20rpx;
  border: 2rpx solid #E0E0E0;
  border-radius: 12rpx;
  background: #F8F8F8;
}

.host-seat {
  border-color: #2196F3;
  background: #E3F2FD;
}

.seat-avatar {
  width: 80rpx;
  height: 80rpx;
  border-radius: 50%;
  background: #E0E0E0;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 15rpx;
}
```

---

## 💡 用户体验最佳实践

### 1. 预期管理
- 通过提示文字（如"非实时同步"）让用户知道会发生什么
- 降低预期，避免焦虑
- 明确告知功能限制

### 2. 即时反馈
- 任何用户操作都应有视觉或触觉反馈
- 即使是在网络请求中也要显示loading
- 操作成功后给予明确提示

### 3. 容错设计
- 允许用户犯错（如提供"回退上一步"功能）
- 提供清晰的恢复路径
- 错误提示友好、具体

### 4. 语言友好
- 使用口语化、幽默的提示语
- 如"网络开小差了"，而非生硬的"网络连接错误"
- 避免技术术语，使用用户能理解的语言

---

## 📱 响应式适配

### 横屏模式（主要）
```css
@media screen and (orientation: landscape) {
  .players-grid {
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: 1fr;
  }
  
  .qr-section {
    display: flex;
    align-items: center;
    gap: 30rpx;
  }
}
```

### 竖屏模式（兼容）
```css
@media screen and (orientation: portrait) {
  .players-grid {
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
  }
  
  .qr-section {
    flex-direction: column;
  }
}
```

---

## 🎯 设计优势

### 用户体验优势
1. **一键创建**：点击"创建比赛"直接进入房间，无需填写表单
2. **灵活加入**：支持扫码、分享、默认昵称多种加入方式
3. **直观管理**：清晰的座位选择界面，房主可编辑玩家信息
4. **操作简化**：减少用户操作步骤，提升使用效率

### 技术优势
1. **成本控制**：简化操作流程，减少云函数调用
2. **性能优化**：本地状态管理，减少网络请求
3. **错误处理**：完善的异常处理和降级方案
4. **可维护性**：清晰的代码结构和组件化设计

### 业务优势
1. **用户留存**：流畅的体验提升用户满意度
2. **功能完整**：一次实现所有核心功能
3. **扩展性**：为后续功能扩展预留空间
4. **兼容性**：保持与现有功能的兼容性

---

## 📋 实施计划

### 第一阶段：基础房间页面
- [ ] 实现房间页面结构
- [ ] 添加房间信息显示
- [ ] 实现二维码生成和显示
- [ ] 添加基础样式

### 第二阶段：座位管理
- [ ] 实现4人座位网格布局
- [ ] 添加玩家信息显示
- [ ] 实现房主编辑功能
- [ ] 添加座位状态管理

### 第三阶段：创建功能
- [ ] 实现一键创建比赛
- [ ] 集成云函数调用
- [ ] 添加用户偏好管理
- [ ] 实现错误处理

### 第四阶段：玩家加入
- [ ] 实现扫码加入功能
- [ ] 添加分享房间功能
- [ ] 实现默认昵称加入
- [ ] 完善状态同步

### 第五阶段：测试优化
- [ ] 功能测试和bug修复
- [ ] 性能优化和体验调优
- [ ] 响应式适配测试
- [ ] 用户反馈收集和优化

---

## 📝 设计变更记录

### v2.0 主要变更
- **简化创建流程**：从弹窗表单改为一键创建
- **优化用户体验**：减少操作步骤，提升使用效率
- **灵活加入方式**：支持扫码、分享、默认昵称多种方式
- **直观座位管理**：清晰的4人座位界面，房主可编辑
- **用户偏好设置**：记住用户选择，减少重复操作

---

**设计方案版本**：v2.0  
**最后更新**：2025-10-01

