<view class="container">
  <!-- ç»Ÿè®¡æ¦‚è§ˆåŒº - ç§»åŠ¨åˆ°é¡¶éƒ¨ -->
  <view class="stats-section">
    <view class="stats-header">
      <text class="stats-title">æ¸¸æˆç»Ÿè®¡</text>
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-number">{{totalGames}}</text>
          <text class="stat-label">æ€»å±€æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{redWins}}</text>
          <text class="stat-label">ä¸œè¥¿æ–¹é˜Ÿèƒœ</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{blueWins}}</text>
          <text class="stat-label">å—åŒ—æ–¹é˜Ÿèƒœ</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{draws}}</text>
          <text class="stat-label">å¹³å±€</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{redWinRate}}%</text>
          <text class="stat-label">ä¸œè¥¿æ–¹é˜Ÿèƒœç‡</text>
        </view>
        <view class="stat-item" wx:if="{{averageDuration > 0}}">
          <text class="stat-number">{{averageDuration}}åˆ†</text>
          <text class="stat-label">å¹³å‡æ—¶é•¿</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å†å²å±€åˆ—è¡¨ - ç§»åŠ¨åˆ°ç»Ÿè®¡ä¸‹é¢ -->
  <view class="history-section">
    <view class="history-header">
      <text class="history-title"></text>
    </view>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{isLoading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <!-- å†å²è®°å½•åˆ—è¡¨ -->
    <view class="history-list" wx:elif="{{filteredHistory.length > 0}}">
      <view class="history-item" wx:for="{{filteredHistory}}" wx:key="gameId" bindtap="onViewDetail" data-index="{{index}}">
        <view class="game-info">
          <view class="game-date">{{item.date}}</view>
          <view class="game-time">{{item.time}}</view>
        </view>
        <view class="team-info">
          <view class="team-red">
            <view class="team-container">
              <view class="team-label">ä¸œè¥¿\næ–¹é˜Ÿ</view>
              <view class="team-players">
                <view class="player-name">{{item.redPlayers ? item.redPlayers[0] : 'ä¸œè¥¿æ–¹é˜Ÿ1å·'}}</view>
                <view class="player-name">{{item.redPlayers ? item.redPlayers[1] : 'ä¸œè¥¿æ–¹é˜Ÿ2å·'}}</view>
              </view>
            </view>
          </view>
          <view class="team-blue">
            <view class="team-container">
              <view class="team-label">å—åŒ—\næ–¹é˜Ÿ</view>
              <view class="team-players">
                <view class="player-name">{{item.bluePlayers ? item.bluePlayers[0] : 'å—åŒ—æ–¹é˜Ÿ1å·'}}</view>
                <view class="player-name">{{item.bluePlayers ? item.bluePlayers[1] : 'å—åŒ—æ–¹é˜Ÿ2å·'}}</view>
              </view>
            </view>
          </view>
        </view>
        <view class="game-result">
          <view class="result-row">
            <view class="score-display">
              <text class="score red">{{item.finalScore.red}}</text>
              <text class="vs">  :  </text>
              <text class="score blue">{{item.finalScore.blue}}</text>
            </view>
            <view class="winner {{item.winner}}">
              {{item.winner === 'red' ? 'ä¸œè¥¿æ–¹é˜Ÿèƒœ' : item.winner === 'blue' ? 'å—åŒ—æ–¹é˜Ÿèƒœ' : 'å¹³å±€'}}
            </view>
          </view>
        </view>
        <view class="action-buttons">
          <button class="detail-btn" bindtap="onViewDetail" data-index="{{index}}">
            <text>è¯¦æƒ…</text>
          </button>
          <button class="share-btn" bindtap="onShareGame" data-index="{{index}}">
            <text>åˆ†äº«</text>
          </button>
          <button class="delete-btn" bindtap="onDeleteGame" data-index="{{index}}">
            <text>åˆ é™¤</text>
          </button>
        </view>
      </view>
    </view>
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <text class="empty-text" wx:if="{{gameHistory.length === 0}}">æš‚æ— å†å²è®°å½•</text>
      <text class="empty-text" wx:else>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å½•</text>
      <text class="empty-desc" wx:if="{{gameHistory.length === 0}}">å¼€å§‹æ¸¸æˆåè®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
      <text class="empty-desc" wx:else>å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰å™¨</text>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’®åŒº - ç§»åŠ¨åˆ°å±å¹•åº•éƒ¨ -->
  <view class="action-section">
    <view class="action-bar">
      <button class="clear-btn" bindtap="onClearAll" wx:if="{{gameHistory.length > 0}}">
        <text class="clear-icon">ğŸ—‘ï¸</text>
        <text class="clear-text">æ¸…ç©ºè®°å½•</text>
      </button>
      <button class="filter-btn {{showFilter ? 'active' : ''}}" 
              bindtap="onToggleFilter">
        <text class="filter-icon">âš™ï¸</text>
        <text class="filter-text">ç­›é€‰</text>
      </button>
    </view>
    
    <!-- ç­›é€‰é¢æ¿ -->
    <view class="filter-panel {{showFilter ? 'show' : ''}}">
      <view class="filter-group">
        <text class="filter-label">ğŸ¯ èƒœè´Ÿç­›é€‰</text>
        <view class="filter-options">
          <button class="filter-option {{filterType === 'all' ? 'active' : ''}}" 
                  data-type="all" bindtap="onFilterChange">
            <text class="option-text">å…¨éƒ¨</text>
            <text class="option-count">({{gameHistory.length}})</text>
          </button>
          <button class="filter-option {{filterType === 'red' ? 'active' : ''}}" 
                  data-type="red" bindtap="onFilterChange">
            <text class="option-text">ä¸œè¥¿æ–¹é˜Ÿèƒœ</text>
            <text class="option-count">({{redWins}})</text>
          </button>
          <button class="filter-option {{filterType === 'blue' ? 'active' : ''}}" 
                  data-type="blue" bindtap="onFilterChange">
            <text class="option-text">å—åŒ—æ–¹é˜Ÿèƒœ</text>
            <text class="option-count">({{blueWins}})</text>
          </button>
          <button class="filter-option {{filterType === 'draw' ? 'active' : ''}}" 
                  data-type="draw" bindtap="onFilterChange">
            <text class="option-text">å¹³å±€</text>
            <text class="option-count">({{draws}})</text>
          </button>
        </view>
      </view>
      
      <view class="filter-group">
        <text class="filter-label">ğŸ“Š æ’åºæ–¹å¼</text>
        <view class="sort-options">
          <button class="sort-option {{sortType === 'time' ? 'active' : ''}}" 
                  data-type="time" bindtap="onSortChange">
            <text class="sort-icon">ğŸ•’</text>
            <text class="sort-text">æ—¶é—´</text>
            <text class="sort-arrow">{{sortType === 'time' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}</text>
          </button>
          <button class="sort-option {{sortType === 'score' ? 'active' : ''}}" 
                  data-type="score" bindtap="onSortChange">
            <text class="sort-icon">ğŸ¯</text>
            <text class="sort-text">æ€»åˆ†</text>
            <text class="sort-arrow">{{sortType === 'score' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}</text>
          </button>
          <button class="sort-option {{sortType === 'duration' ? 'active' : ''}}" 
                  data-type="duration" bindtap="onSortChange">
            <text class="sort-icon">â±ï¸</text>
            <text class="sort-text">æ—¶é•¿</text>
            <text class="sort-arrow">{{sortType === 'duration' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}</text>
          </button>
        </view>
      </view>
      
      <view class="filter-actions">
        <button class="reset-btn" bindtap="onResetFilters">é‡ç½®ç­›é€‰</button>
        <button class="close-filter-btn" bindtap="onToggleFilter">å…³é—­</button>
      </view>
    </view>
  </view>

  <!-- è¯¦æƒ…å¼¹çª— -->
  <view class="detail-modal" wx:if="{{showDetail}}" bindtap="onCloseDetail">
    <view class="detail-content" catchtap="stopPropagation">
      <view class="detail-header">
        <text class="scores-title">æœ¬æŠŠè¯¦ç»†æ¯”åˆ†</text>
        <text class="close-btn" bindtap="onCloseDetail">Ã—</text>
      </view>
        <view class="detail-scores">
        <view class="scores-table">
          <!-- è¡Œæ ‡é¢˜åˆ— -->
          <view class="row-header-column">
            <view class="row-header-cell header-cell">æŠŠæ•°</view>
            <view class="row-header-cell header-cell">çº¢æ–¹</view>
            <view class="row-header-cell header-cell">è“æ–¹</view>
          </view>
          <!-- å¯æ»šåŠ¨çš„æ•°æ®åŒºåŸŸ -->
          <view class="table-data-container">
            <!-- æŠŠæ•°è¡Œ -->
            <view class="table-row">
              <text class="table-cell" wx:for="{{selectedGame.detailedScores}}" wx:key="index">{{index + 1}}</text>
            </view>
            <!-- çº¢æ–¹è¡Œ -->
            <view class="table-row">
              <text class="table-cell red" wx:for="{{selectedGame.detailedScores}}" wx:key="index">{{item.red}}</text>
            </view>
            <!-- è“æ–¹è¡Œ -->
            <view class="table-row">
              <text class="table-cell blue" wx:for="{{selectedGame.detailedScores}}" wx:key="index">{{item.blue}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
