<view class="container">
  <!-- ç»Ÿè®¡æ¦‚è§ˆåŒº - ç§»åŠ¨åˆ°é¡¶éƒ¨ -->
  <view class="stats-section">
    <view class="stats-header">
      <text class="stats-title">æ¸¸æˆç»Ÿè®¡</text>
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-number">{{totalGames}}</text>
          <text class="stat-label">æ€»å±€æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{redWins}}</text>
          <text class="stat-label">ä¸œè¥¿æ–¹é˜Ÿèƒœ</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{blueWins}}</text>
          <text class="stat-label">å—åŒ—æ–¹é˜Ÿèƒœ</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{draws}}</text>
          <text class="stat-label">å¹³å±€</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{redWinRate}}%</text>
          <text class="stat-label">ä¸œè¥¿æ–¹é˜Ÿèƒœç‡</text>
        </view>
        <view class="stat-item" wx:if="{{averageDuration > 0}}">
          <text class="stat-number">{{averageDuration}}åˆ†</text>
          <text class="stat-label">å¹³å‡æ—¶é•¿</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å†å²å±€åˆ—è¡¨ - ç§»åŠ¨åˆ°ç»Ÿè®¡ä¸‹é¢ -->
  <view class="history-section">
    <view class="history-header">
      <text class="history-title"></text>
    </view>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{isLoading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <!-- å†å²è®°å½•åˆ—è¡¨ -->
    <view class="history-list" wx:elif="{{filteredHistory.length > 0}}">
      <view class="history-item" wx:for="{{filteredHistory}}" wx:key="gameId" bindtap="onViewDetail" data-index="{{index}}">
        <view class="game-info">
          <view class="game-date">{{item.date}}</view>
          <view class="game-time">{{item.time}}</view>
        </view>
        <view class="team-info">
          <view class="team-red">
            <view class="team-container">
              <view class="team-label">ä¸œè¥¿\næ–¹é˜Ÿ</view>
              <view class="team-players">
                <view class="player-name">{{item.redPlayers ? item.redPlayers[0] : 'ä¸œè¥¿æ–¹é˜Ÿ1å·'}}</view>
                <view class="player-name">{{item.redPlayers ? item.redPlayers[1] : 'ä¸œè¥¿æ–¹é˜Ÿ2å·'}}</view>
              </view>
            </view>
          </view>
          <view class="team-blue">
            <view class="team-container">
              <view class="team-label">å—åŒ—\næ–¹é˜Ÿ</view>
              <view class="team-players">
                <view class="player-name">{{item.bluePlayers ? item.bluePlayers[0] : 'å—åŒ—æ–¹é˜Ÿ1å·'}}</view>
                <view class="player-name">{{item.bluePlayers ? item.bluePlayers[1] : 'å—åŒ—æ–¹é˜Ÿ2å·'}}</view>
              </view>
            </view>
          </view>
        </view>
        <view class="game-result">
          <view class="result-row">
            <view class="score-display">
              <text class="score red">{{item.finalScore.red}}</text>
              <text class="vs">  :  </text>
              <text class="score blue">{{item.finalScore.blue}}</text>
            </view>
            <view class="winner {{item.winner}}">
              {{item.winner === 'red' ? 'ä¸œè¥¿æ–¹é˜Ÿèƒœ' : item.winner === 'blue' ? 'å—åŒ—æ–¹é˜Ÿèƒœ' : 'å¹³å±€'}}
            </view>
          </view>
        </view>
        <view class="action-buttons">
          <button class="detail-btn" bindtap="onViewDetail" data-index="{{index}}">
            <text>è¯¦æƒ…</text>
          </button>
          <button class="share-btn" bindtap="onShareGame" data-index="{{index}}">
            <text>åˆ†äº«</text>
          </button>
          <button class="delete-btn" bindtap="onDeleteGame" data-index="{{index}}">
            <text>åˆ é™¤</text>
          </button>
        </view>
      </view>
    </view>
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <text class="empty-text" wx:if="{{gameHistory.length === 0}}">æš‚æ— å†å²è®°å½•</text>
      <text class="empty-text" wx:else>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å½•</text>
      <text class="empty-desc" wx:if="{{gameHistory.length === 0}}">å¼€å§‹æ¸¸æˆåè®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
      <text class="empty-desc" wx:else>å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰å™¨</text>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’®åŒº - ç§»åŠ¨åˆ°å±å¹•åº•éƒ¨ -->
  <view class="action-section">
    <view class="action-bar">
      <button class="clear-btn" bindtap="onClearAll" wx:if="{{gameHistory.length > 0}}">
        <text class="clear-icon">ğŸ—‘ï¸</text>
        <text class="clear-text">æ¸…ç©ºè®°å½•</text>
      </button>
      <button class="filter-btn {{showFilter ? 'active' : ''}}" 
              bindtap="onToggleFilter">
        <text class="filter-icon">âš™ï¸</text>
        <text class="filter-text">ç­›é€‰</text>
      </button>
    </view>
    
    <!-- ç­›é€‰é¢æ¿ -->
    <view class="filter-panel {{showFilter ? 'show' : ''}}">
      <!-- æ—¶é—´ç­›é€‰ -->
      <view class="filter-group">
        <view class="filter-label" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10rpx;">
          <text>ğŸ“… æ—¶é—´ç­›é€‰</text>
          <view class="action-buttons" style="display: flex; gap: 6rpx;">
            <button class="action-btn" style="padding: 6rpx 12rpx; background: #6c757d; color: white; border: none; border-radius: 4rpx; font-size: 16rpx;" bindtap="onResetFilters">é‡ç½®</button>
            <button class="action-btn close-btn" style="padding: 6rpx 12rpx; background: #1565C0; color: white; border: none; border-radius: 4rpx; font-size: 16rpx;" bindtap="onToggleFilter">å…³é—­</button>
          </view>
        </view>
        <view class="filter-options">
          <button class="filter-option {{timeFilter === 'all' ? 'active' : ''}}" 
                  data-time="all" bindtap="onTimeFilterChange">
            <text class="option-text">å…¨éƒ¨æ—¶é—´</text>
          </button>
          <button class="filter-option {{timeFilter === 'week' ? 'active' : ''}}" 
                  data-time="week" bindtap="onTimeFilterChange">
            <text class="option-text">æœ¬å‘¨</text>
          </button>
          <button class="filter-option {{timeFilter === 'lastWeek' ? 'active' : ''}}" 
                  data-time="lastWeek" bindtap="onTimeFilterChange">
            <text class="option-text">ä¸Šå‘¨</text>
          </button>
          <button class="filter-option {{timeFilter === 'month' ? 'active' : ''}}" 
                  data-time="month" bindtap="onTimeFilterChange">
            <text class="option-text">æœ¬æœˆ</text>
          </button>
          <button class="filter-option {{timeFilter === 'lastMonth' ? 'active' : ''}}" 
                  data-time="lastMonth" bindtap="onTimeFilterChange">
            <text class="option-text">ä¸Šæœˆ</text>
          </button>
          <button class="filter-option {{timeFilter === 'custom' ? 'active' : ''}}" 
                  data-time="custom" bindtap="onTimeFilterChange">
            <text class="option-text">è‡ªå®šä¹‰æ—¶é—´</text>
          </button>
        </view>
        <!-- è‡ªå®šä¹‰æ—¶é—´é€‰æ‹©å™¨ -->
        <view class="custom-time-picker" wx:if="{{showCustomTimePicker}}" style="margin-top: 10rpx; padding: 10rpx; border: 1rpx solid #e9ecef; border-radius: 4rpx; background: #f8f9fa;">
          <view style="margin-bottom: 8rpx;">
            <text style="font-size: 14rpx; color: #2c3e50;">å¼€å§‹æ—¶é—´ï¼š</text>
            <picker mode="date" value="{{customStartDate}}" bindchange="onCustomStartDateChange" style="display: inline-block; margin-left: 8rpx;">
              <text style="padding: 4rpx 8rpx; border: 1rpx solid #ddd; border-radius: 4rpx; font-size: 14rpx;">{{customStartDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
            </picker>
          </view>
          <view style="margin-bottom: 8rpx;">
            <text style="font-size: 14rpx; color: #2c3e50;">ç»“æŸæ—¶é—´ï¼š</text>
            <picker mode="date" value="{{customEndDate}}" bindchange="onCustomEndDateChange" style="display: inline-block; margin-left: 8rpx;">
              <text style="padding: 4rpx 8rpx; border: 1rpx solid #ddd; border-radius: 4rpx; font-size: 14rpx;">{{customEndDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
            </picker>
          </view>
          <button style="padding: 6rpx 12rpx; background: #4CAF50; color: white; border: none; border-radius: 4rpx; font-size: 14rpx;" bindtap="onApplyCustomTime">åº”ç”¨ç­›é€‰</button>
        </view>
      </view>
      
      <!-- é˜Ÿå‹ç­›é€‰ (v2.1.0) -->
      <view class="filter-group" wx:if="{{allTeammates.length > 0}}" style="opacity: 0.4;">
        <text class="filter-label">ğŸ‘¥ é˜Ÿå‹ç­›é€‰ (v2.1.0)</text>
        <view class="filter-options">
          <button class="filter-option {{teammateFilter === 'all' ? 'active' : ''}}" 
                  data-teammate="all" bindtap="onTeammateFilterChange">
            <text class="option-text">å…¨éƒ¨é˜Ÿå‹</text>
          </button>
          <button class="filter-option {{teammateFilter === 'mostActive' ? 'active' : ''}}" 
                  data-teammate="mostActive" bindtap="onTeammateFilterChange">
            <text class="option-text">æœ€æ´»è·ƒé˜Ÿå‹</text>
          </button>
          <button class="filter-option {{teammateFilter === 'recent' ? 'active' : ''}}" 
                  data-teammate="recent" bindtap="onTeammateFilterChange">
            <text class="option-text">æœ€è¿‘å‚ä¸</text>
          </button>
          <button class="filter-option {{teammateFilter === 'alphabetical' ? 'active' : ''}}" 
                  data-teammate="alphabetical" bindtap="onTeammateFilterChange">
            <text class="option-text">æŒ‰å­—æ¯æ’åº</text>
          </button>
        </view>
      </view>
      
      <!-- ä¸ªäººç»Ÿè®¡ (v4.0) -->
      <view class="filter-group" style="opacity: 0.4;">
        <text class="filter-label">ğŸ“ˆ ä¸ªäººç»Ÿè®¡ (v4.0)</text>
        <view class="filter-options">
          <button class="filter-option">
            <text class="option-text">ä¸ªäººæˆ˜ç»©</text>
          </button>
          <button class="filter-option">
            <text class="option-text">è¿›æ­¥è½¨è¿¹</text>
          </button>
          <button class="filter-option">
            <text class="option-text">æœ€ä½³è¡¨ç°</text>
          </button>
        </view>
      </view>

      <!-- ç­›é€‰ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="filter-stats" style="background: #1565C0; padding: 10rpx; border-radius: 4rpx; margin-bottom: 10rpx; font-size: 14rpx; color: white;">
        <text>ğŸ“Š ç­›é€‰ç»Ÿè®¡ï¼š</text>
        <text>â€¢ æ€»æ¯”èµ›æ•°ï¼š{{gameHistory.length}}åœº</text>
        <text>â€¢ å½“å‰åŠŸèƒ½ï¼šæ—¶é—´ç­›é€‰</text>
        <text>â€¢ é˜Ÿå‹ç­›é€‰ï¼šå¾…å®ç° (v2.1.0)</text>
        <text>â€¢ ä¸ªäººç»Ÿè®¡ï¼šå¾…å®ç° (v4.0)</text>
      </view>
    </view>
  </view>

  <!-- è¯¦æƒ…å¼¹çª— -->
  <view class="detail-modal" wx:if="{{showDetail}}" bindtap="onCloseDetail">
    <view class="detail-content" catchtap="stopPropagation">
      <view class="detail-header">
        <text class="scores-title">æœ¬æŠŠè¯¦ç»†æ¯”åˆ†</text>
        <text class="close-btn" bindtap="onCloseDetail">Ã—</text>
      </view>
        <view class="detail-scores">
        <view class="scores-table">
          <!-- è¡Œæ ‡é¢˜åˆ— -->
          <view class="row-header-column">
            <view class="row-header-cell header-cell">æŠŠæ•°</view>
            <view class="row-header-cell header-cell">çº¢æ–¹</view>
            <view class="row-header-cell header-cell">è“æ–¹</view>
          </view>
          <!-- å¯æ»šåŠ¨çš„æ•°æ®åŒºåŸŸ -->
          <view class="table-data-container">
            <!-- æŠŠæ•°è¡Œ -->
            <view class="table-row">
              <text class="table-cell" wx:for="{{selectedGame.detailedScores}}" wx:key="index">{{index + 1}}</text>
            </view>
            <!-- çº¢æ–¹è¡Œ -->
            <view class="table-row">
              <text class="table-cell red" wx:for="{{selectedGame.detailedScores}}" wx:key="index">{{item.red}}</text>
            </view>
            <!-- è“æ–¹è¡Œ -->
            <view class="table-row">
              <text class="table-cell blue" wx:for="{{selectedGame.detailedScores}}" wx:key="index">{{item.blue}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
